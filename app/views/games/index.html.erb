<div class='container'>
  <div class='row'>
    <%= render 'form' %>
  </div>

  <div class='row'>
    <div class='col-md-3'>
      <dl>
        <dt>Total games:</dt>
        <dd><%= Game.count %></dd>
        <dt>Draws:</dt>
        <dd class='draw'><%= Game.draws.count %></dd>
        <dt>Paul wins:</dt>
        <dd class='paul'><%= Game.wins_by('Paul').count %></dd>
        <dt>Oli wins:</dt>
        <dd class='oli'><%= Game.wins_by('Oli').count %></dd>
        <dt>Paul total score:</dt>
        <dd class='paul'><%= Player.find_by_name('Paul').total_score %></dd>
        <dt>Oli total score:</dt>
        <dd class='oli'><%= Player.find_by_name('Oli').total_score %></dd>


        <dt>Top three wins</dt>
        <% Game.no_notes.biggest_wins(3).each do |game|  %>
          <dd class='<%= game.winner.name.downcase %>'><%= game.winner.name %> - <%= game.score(game.winner.name)  %> to 
          <%= game.score(game.loser.name) %> on <%= game.map.name %> with 
          <%= game.weapon_set.name%></dd>
        <% end %>

        <!--
        <dt>Biggest win overall:</dt>
        <% game = Game.biggest_wins.first  %>
        <dd><%= game.winner.name %> - <%= game.score(game.winner.name)  %> to 
        <%= game.score(game.loser.name) %> on <%= game.map.name %> with 
        <%= game.weapon_set.name%> <em><%= game.notes.present? ? "(#{game.notes.first.body})" : nil %></em></dd>
        -->
      </dl>
    </div>

    <div class='col-md-3'>
      <h4>Map usage:</h4>
      <table class='table table-condensed'>
        <% Map.popularity.each do |map| %>
          <tr>
            <td><%= map.name %></td>
            <td><%= map.games.count %></td>
            <td class='paul <%= map.current_winner == 'Paul' ? 'bold' : 'light' %>'><%= number_with_precision map.win_percentage(:paul), precision: 0%>%</td>
            <td class='oli <%= map.current_winner == 'Oli' ? 'bold' : 'light' %>'><%= number_with_precision map.win_percentage(:oli), precision: 0 %>%</td>
          </tr>
        <% end %>
      </table>
    </div>

    <div class='col-md-3'>
      <h4>Weapon usage:</h4>
      <table class='table table-condensed' >
        <% WeaponSet.popularity.each do |ws| %>
          <tr>
            <td><%= ws.name %></td>
            <td><%= ws.games.count %></td>
            <td class='paul <%= ws.current_winner == 'Paul' ? 'bold' : 'light' %>'><%= number_with_precision ws.win_percentage(:paul), precision: 0 %>%</td>
            <td class='oli <%= ws.current_winner == 'Oli' ? 'bold' : 'light' %>'><%= number_with_precision ws.win_percentage(:oli), precision: 0 %>%</td>
          </tr>
        <% end %>
      </table>
    </div>
  </div>

  <div class='row'>
    <h4>All games</h4>
    <table class='table table-condensed'>
      <thead>
        <tr>
          <th>Paul</th>
          <th>Oli</th>
          <th>Map</th>
          <th>Weapons</th>
          <th>Notes</th>
        </tr>
      </thead>

      <tbody>
        <% @games.each_with_index do |game, index| %>
          <tr class=<%= game.winner.present? ? (game.winner.name == 'Paul' ? 'paul' : 'oli') : 'draw' %>>
            <td><%= game.score('Paul') %>
            <td><%= game.score('Oli') %>
            <td><%= game.map.name %>
            <td><%= game.weapon_set.name %>
            <td><%= game.notes.first.try(:body) %>
          </tr>
          <% if game.different_playing_session?(@games[index + 1]) %>
            <tr>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
